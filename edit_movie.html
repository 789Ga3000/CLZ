<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Movie - Coolgenz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #f1f1f1;
    }
    .container {
      max-width: 850px;
      margin-top: 40px;
      background: #1e1e1e;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    }
    label {
      font-weight: 600;
      margin-top: 12px;
    }
    .form-control, .form-select {
      background-color: #222;
      color: white;
      border: 1px solid #333;
    }
    .btn-save {
      background-color: #e50914;
      color: white;
      font-weight: 600;
    }
    .btn-save:hover { background-color: #f40612; }
    .btn-cancel {
      background-color: #444;
      color: white;
    }
    .current-img {
      max-height: 120px;
      border-radius: 6px;
      margin-top: 10px;
    }

    .info-banner {
      background: rgba(229, 9, 20, 0.12);
      border: 1px solid rgba(229, 9, 20, 0.25);
      color: #f1f1f1;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 0.95rem;
      line-height: 1.5;
      margin-bottom: 1.5rem;
    }

    .field-hint {
      margin-top: 0.4rem;
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.7);
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="text-center text-danger mb-4">✏️ Edit Movie</h2>

    <div class="info-banner">
      Uploading a new movie file streams it directly to the remote storage server. You can keep the existing links or leave them blank if you replace the full video.
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'success' if category=='success' else 'danger' }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" enctype="multipart/form-data">
      
      <!-- Movie Title -->
      <label for="title">Movie Title</label>
      <input type="text" id="title" name="title" class="form-control" value="{{ movie.title }}" required>

  <!-- Links -->
      <label>Video Links (optional if you upload a movie file)</label>
      <div id="links-container">
        {% for link in movie.links_list %}
          <input type="text" name="links[]" class="form-control mb-2" value="{{ link }}">
        {% endfor %}
        <input type="text" name="links[]" class="form-control mb-2" placeholder="Add new link">
      </div>
      <button type="button" class="btn btn-sm btn-secondary mt-2" onclick="addLink()">+ Add Link</button>
      <p class="field-hint">If you upload a new movie file, you can clear any outdated streaming URLs.</p>

      <label for="file">Upload Movie File</label>
      <input type="file" id="file" name="file" class="form-control" accept="video/*">
  <p class="field-hint">Large files will be streamed straight to remote storage (no local copies kept).</p>

      <!-- Genres -->
      <label for="genres">Genres</label>
      <select id="genres" name="genres" class="form-select" multiple>
        {% for g in all_genres %}
          <option value="{{ g }}" {% if g in movie.genres_list %}selected{% endif %}>{{ g }}</option>
        {% endfor %}
      </select>

      <label for="new_genre">Add New Genre</label>
      <input type="text" id="new_genre" name="new_genre" class="form-control" placeholder="Enter new genre">

      <!-- Description -->
      <label for="description">Description</label>
      <textarea id="description" name="description" rows="4" class="form-control">{{ movie.description }}</textarea>

      <!-- Year -->
      <label for="year">Year</label>
      <input type="number" id="year" name="year" class="form-control" value="{{ movie.year }}">

      <!-- Language -->
      <label for="language">Language</label>
      <input type="text" id="language" name="language" class="form-control" value="{{ movie.language }}">

      <!-- Featured -->
      <div class="form-check mt-3">
        <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured" {% if movie.is_featured %}checked{% endif %}>
        <label class="form-check-label" for="is_featured">Mark as Featured</label>
      </div>

      <!-- Current Poster -->
      <label>Current Poster</label><br>
      {% if movie.image %}
        <img src="{{ media_url(movie.image, 'images', url_for('static', filename='images/placeholder.jpg')) }}" class="current-img">
      {% else %}
        <p>No poster uploaded</p>
      {% endif %}

      <!-- Upload New Poster -->
      <label for="image">Upload New Poster</label>
      <input type="file" id="image" name="image" class="form-control">

      <!-- Trailer -->
  <label for="trailer">Upload Trailer (optional)</label>
  <input type="file" id="trailer" name="trailer" class="form-control" accept="video/*">

      <!-- Save / Cancel -->
      <div class="d-flex justify-content-between mt-4">
        <a href="{{ url_for('admin') }}" class="btn btn-cancel">Cancel</a>
        <button type="submit" class="btn btn-save">Save Changes</button>
      </div>
    </form>
  </div>

  <script>
    function addLink() {
      const container = document.getElementById("links-container");
      const input = document.createElement("input");
      input.type = "text";
      input.name = "links[]";
      input.className = "form-control mb-2";
      input.placeholder = "Add new link";
      container.appendChild(input);
    }
  </script>
</body>
</html>
